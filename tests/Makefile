.PHONY: all install test clean

SOURCES := $(wildcard ../CRISPResso2/*.py*)
TEST_DIRECTORIES := CRISPResso_on_FANC.Cas9 CRISPResso_on_params CRISPRessoBatch_on_FANC \
CRISPRessoPooled_on_Both.Cas9 CRISPRessoWGS_on_Both.Cas9.fastq.smallGenome \
CRISPRessoCompare_on_Cas9_VS_Untreated

all: test

install: $(SOURCES)
	cd .. && pip install -e .

test: clean $(TEST_DIRECTORIES)

clean:
	rm -rf CRISPResso_on_FANC.Cas9* CRISPResso_on_params* CRISPRessoBatch_on_FANC* \
CRISPRessoPooled_on_Both.Cas9* CRISPRessoWGS_on_Both.Cas9.fastq.smallGenome* \
CRISPRessoCompare_on_Cas9_VS_Untreated*

CRISPResso_on_FANC.Cas9: install
	time CRISPResso -r1 FANC.Cas9.fastq -a CGGATGTTCCAATCAGTACGCAGAGAGTCGCCGTCTCCAAGGTGAAAGCGGAAGTAGGGCCTTCGCGCACCTCATGGAATCCCTTCTGCAGCACCTGGATCGCTTTTCCGAGCTTCTGGCGGTCTCAAGCACTACCTACGTCAGCACCTGGGACCCCGCCACCGTGCGCCGGGCCTTGCAGTGGGCGCGCTACCTGCGCCACATCCATCGGCGCTTTGGTCGG -g GGAATCCCTTCTGCAGCACC --debug
	python diff.py $@

CRISPResso_on_params: install
	time CRISPResso -r1 FANC.Cas9.fastq -a CGGATGTTCCAATCAGTACGCAGAGAGTCGCCGTCTCCAAGGTGAAAGCGGAAGTAGGGCCTTCGCGCACCTCATGGAATCCCTTCTGCAGCACCTGGATCGCTTTTCCGAGCTTCTGGCGGTCTCAAGCACTACCTACGTCAGCACCTGGGACCCCGCCACCGTGCGCCGGGCCTTGCAGTGGGCGCGCTACCTGCGCCACATCCATCGGCGCTTTGGTCGG -g GGAATCCCTTCTGCAGCACC -e CGGCCGGATGTTCCAATCAGTACGCAGAGAGTCGCCGTCTCCAAGGTGAAAGCTGAAGTAGGGCCTTCGCGCACCTCATGGAATCCCTTCTGCAGCTTTTCCGAGCTTCTGGCGGTCTCAAGCACTACCTACGTCAGCACCTGGGACCCCGCCACCGTGCGCCGGGCCTTGCAGTGGGCGCGCTACCTGCGCCACATCCATCGGCGCTTTGGTCGG -c GGGCCTTCGCGCACCTCATGGAATCCCTTCTGCAGCACCTGGATCGCTTTT --dump -qwc 20-30_45-50 -q 30 --default_min_aln_score 80 -an FANC -n params --base_edit -fg AGCCTTGCAGTGGGCGCGCTA,CCCACTGAAGGCCC --dsODN GCTAGATTTCCCAAGAAGA -gn hi -fgn dear --debug
	python diff.py $@

CRISPRessoBatch_on_FANC: install
	time CRISPRessoBatch -bs FANC.batch -a CGGATGTTCCAATCAGTACGCAGAGAGTCGCCGTCTCCAAGGTGAAAGCGGAAGTAGGGCCTTCGCGCACCTCATGGAATCCCTTCTGCAGCACCTGGATCGCTTTTCCGAGCTTCTGGCGGTCTCAAGCACTACCTACGTCAGCACCTGGGACCCCGCCACCGTGCGCCGGGCCTTGCAGTGGGCGCGCTACCTGCGCCACATCCATCGGCGCTTTGGTCGG -g GGAATCCCTTCTGCAGCACC --debug --base_editor
	python diff.py $@

CRISPRessoPooled_on_Both.Cas9: install
	time CRISPRessoPooled -r1 Both.Cas9.fastq -f Cas9.amplicons.txt --keep_intermediate --min_reads_to_use_region 100 -p 4 --debug
	python diff.py $@

CRISPRessoWGS_on_Both.Cas9.fastq.smallGenome: install
	time CRISPRessoWGS -b Both.Cas9.fastq.smallGenome.bam -r smallGenome/smallGenome.fa -f Cas9.regions.txt --debug
	python diff.py $@

CRISPRessoCompare_on_Cas9_VS_Untreated: install
	time CRISPRessoCompare CRISPRessoBatch_on_FANC/CRISPResso_on_Cas9/ CRISPRessoBatch_on_FANC/CRISPResso_on_Untreated/ --debug
	python diff.py $@
